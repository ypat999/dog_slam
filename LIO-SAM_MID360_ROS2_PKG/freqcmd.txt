# 启动可视化（在导航前启动，占cpu多可考虑设置初始点后关闭）：
rviz2

# 关闭控制服务
sudo systemctl stop robot_control.service

# 启动建图：
sudo systemctl start lio_sam_buildmap.service

# 或  使用slamtoolbox建图
BUILD_MAP=true BUILD_TOOL=slam_toolbox ros2 launch lio_sam lio_sam_nav2.launch.py localization:=slam_toolbox

# 保存二维地图(amcl)：
source ros2/install/setup.bash 
ros2 run nav2_map_server map_saver_cli -t /projected_map -f /home/ztl/slam_data/map_10 --fmt png

# 保存位姿图(slam_toolbox)：
# 调用 serialize_map 服务保存序列化地图
ros2 service call /slam_toolbox/serialize_map slam_toolbox/srv/SerializePoseGraph "{filename: '/home/ztl/slam_data/posegraph/my_map'}"
ros2 service call /slam_toolbox/save_map slam_toolbox/srv/SaveMap "{name: {data: '/home/ztl/slam_data/posegraph/my_2dmap'}}"



# 保存点云 （不使用）
source ros2/install/setup.bash 
ros2 service call /lio_sam/save_map lio_sam/srv/SaveMap "{resolution: 0.2, destination: '/projects/LOAM/'}"

# 录制点云信息供离线调试：
cd dog_slam
source LIO-SAM_MID360_ROS2_PKG/ros2/install/setup.bash
nohup ros2 bag record -o /home/ztl/slam_data/livox_record_tilt_test/ /livox/lidar /livox/imu > record.log &
tail -f record.log 
ps -ef | grep  livox_record_tilt_test
kill -

# 关闭建图：
sudo systemctl stop lio_sam_buildmap.service





# 启动导航：
sudo systemctl start lio_sam_nav2.service

# 查看日志（启动后尽快运行，避免错过ERROR）：
sudo journalctl -u lio_sam_nav2.service -f

# 设置初始点：
rviz2内点击2d pose estimate后点击地图拖动方向

# 设置目标点：
rviz2内点击2d goal后点击地图拖动方向

# 地图刷新：
ros2 service call /map_server/load_map nav2_msgs/srv/LoadMap "{map_url: '/home/ztl/slam_data/grid_map/map.yaml'}"

# 定位模块全局自动重定位：
ros2 service call /reinitialize_global_localization std_srvs/srv/Empty {}

# 机器狗站立：
ros2 service call /rkbot/setctrlmode robot_interface/srv/SetCtrlMode "{mode: {value: 1}}"

# 机器狗趴下：
ros2 service call /rkbot/setctrlmode robot_interface/srv/SetCtrlMode "{mode: {value: 0}}"

# 关闭控制服务
sudo systemctl stop robot_control.service


# 关闭导航：
sudo systemctl stop lio_sam_nav2.service

# 检查组件是否完全关闭：
ps -ef | grep rosbridge
ps -ef | grep rclcpp
lsof -i:8083



# 其他：

echo $DISPLAY

export ROS_DOMAIN_ID=27
cd ros2
export DISPLAY=localhost:10.0

colcon build --symlink-install --packages-select lio_sam && source install/setup.bash &&BUILD_MAP=True ros2 launch lio_sam lio_sam.launch.py
colcon build --symlink-install --packages-select lio_sam && source install/setup.bash && ros2 launch lio_sam nav2.launch.py

/home/ywj/projects/git/dog_slam/LIO-SAM_MID360_ROS2_PKG/ros2/src/LIO-SAM_MID360_ROS2_DOG/web/run_web.sh




source install/setup.bash && ros2 launch livox_ros_driver2 msg_MID360_launch.py








ros2 topic list
ros2 node list



pkill -f ros
ros2 daemon stop && ros2 daemon start







ros2 run tf2_ros tf2_monitor map odom


ros2 lifecycle set /static_transform_publisher_odom_base shutdown




source install/setup.bash
nohup ros2 launch lio_sam lio_sam_nav2.launch.py ns:=/ > record.log &
tail -f record.log








ps -ef | grep ros

colcon build --symlink-install --packages-select lio_sam

BUILD_MAP=True ros2 launch lio_sam lio_sam.launch.py
BUILD_MAP=False ros2 launch nav2_dog_slam lio_sam_nav2.launch.py
ros2 launch fast_lio mapping.launch.py
ros2 launch nav2_dog_slam fast_lio_nav2.launch.py


