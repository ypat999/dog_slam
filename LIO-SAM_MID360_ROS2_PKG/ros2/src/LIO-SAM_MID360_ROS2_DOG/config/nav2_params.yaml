# æ·»åŠ lifecycle_manageré…ç½®
lifecycle_manager:
  ros__parameters:
    use_sim_time: use_sim_time
    autostart: false
    node_names: 
      - map_server
      - amcl
      - controller_server
      - planner_server
      - behavior_server
      - bt_navigator
      - waypoint_follower
      - velocity_smoother
      
    bond_timeout_ms: 4000
    attempt_respawn_reconnection: false
    respawn_reconnection_delay_s: 0.0  # â›” ç¦æ­¢å»¶æ—¶é‡è¿æœºåˆ¶
    update_rate: 2.0               # å®šæœŸçŠ¶æ€æ£€æŸ¥é¢‘ç‡ï¼Œå¯ç•¥ä½ä¸€ç‚¹å‡è´Ÿè½½
    shutdown_on_error: true        # ğŸš¨ èŠ‚ç‚¹å¼‚å¸¸åˆ™å…¨å±€å®‰å…¨åœæœº

amcl:
  ros__parameters:
    use_sim_time: use_sim_time

    # é‡Œç¨‹è®¡è¯é¢˜
    odom_topic: /lio_sam/mapping/odometry
    base_frame_id: base_link
    odom_frame_id: odom
    scan_topic: /lio_sam/scan

    # ç²’å­æ»¤æ³¢å™¨å‚æ•° - ä¼˜åŒ–å®šä½ç¨³å®šæ€§å’Œè®¡ç®—æ•ˆç‡
    min_particles: 1000       # å‡å°‘æœ€å°‘ç²’å­æ•°ï¼Œæé«˜è®¡ç®—æ•ˆç‡
    max_particles: 8000      # æ˜¾è‘—å‡å°‘æœ€å¤§ç²’å­æ•°ï¼Œé˜²æ­¢è¿‡åº¦åˆ†æ•£åˆ°åœ°å›¾å¤–
    kld_err: 0.01            # é€‚å½“æé«˜KLD-samplingè¯¯å·®ï¼Œå¹³è¡¡ç²¾åº¦å’Œæ•ˆç‡
    kld_z: 0.99              # é€‚å½“é™ä½KLDç½®ä¿¡åº¦ï¼Œå‡å°‘ç²’å­æ•°é‡çˆ†ç‚¸
    
    # ç²’å­åˆ†å¸ƒçº¦æŸå‚æ•°
    pf_dist_threshold: 0.3   # é€‚å½“æé«˜ç²’å­è·ç¦»é˜ˆå€¼ï¼Œé¿å…è¿‡åº¦æ‹¥æŒ¤
    pf_straight_threshold: 0.2  # é€‚å½“æé«˜ç›´çº¿è¿åŠ¨é˜ˆå€¼ï¼Œå‡å°‘é¢‘ç¹æ›´æ–°
    pf_turn_threshold: 0.1     # é€‚å½“æé«˜æ—‹è½¬è¿åŠ¨é˜ˆå€¼ï¼Œå‡å°‘æŠ–åŠ¨

    # é‡Œç¨‹è®¡è¿åŠ¨æ¨¡å‹å™ªå£°å‚æ•° - åŸºäºå®é™…æœºå™¨äººè¿åŠ¨ç‰¹æ€§ä¼˜åŒ–
    alpha1: 0.02            # è¿›ä¸€æ­¥é™ä½æ—‹è½¬-æ—‹è½¬å™ªå£°ï¼Œæé«˜æ—‹è½¬ç²¾åº¦
    alpha2: 0.005           # è¿›ä¸€æ­¥é™ä½å¹³ç§»-æ—‹è½¬å™ªå£°ï¼Œæé«˜ç›´çº¿è¿åŠ¨ç²¾åº¦
    alpha3: 0.02            # é™ä½å¹³ç§»-å¹³ç§»å™ªå£°ï¼Œå‡å°‘ä½ç½®æ¼‚ç§»
    alpha4: 0.005           # è¿›ä¸€æ­¥é™ä½æ—‹è½¬-å¹³ç§»å™ªå£°ï¼Œæé«˜æ•´ä½“ç¨³å®šæ€§
    alpha5: 0.01            # æ·»åŠ é¢å¤–å™ªå£°å‚æ•°ï¼Œæé«˜æ¨¡å‹é²æ£’æ€§

    # æ¿€å…‰ä¼ æ„Ÿå™¨å™ªå£°å‚æ•° - ä¼˜åŒ–å®šä½ç²¾åº¦å’Œç¨³å®šæ€§
    laser_lambda_short: 0.1
    laser_sigma_hit: 0.1         # è¿›ä¸€æ­¥é™ä½æ¿€å…‰å‡»ä¸­å™ªå£°ï¼Œæé«˜åŒ¹é…ç²¾åº¦
    laser_z_hit: 0.85            # å¢åŠ å‡»ä¸­æ¦‚ç‡ï¼Œæé«˜å®šä½ç¨³å®šæ€§
    laser_z_rand: 0.1            # é™ä½éšæœºæµ‹é‡æ¦‚ç‡ï¼Œå‡å°‘å¼‚å¸¸åŒ¹é…
    laser_z_max: 0.05            # ä¿æŒæœ€å¤§è·ç¦»æµ‹é‡æ¦‚ç‡
    laser_max_beams: 80          # é€‚å½“å‡å°‘å…‰æŸæ•°é‡ï¼Œæé«˜è®¡ç®—æ•ˆç‡å¹¶å‡å°‘å¼‚å¸¸æ•°æ®å½±å“

    # ä½å§¿æ›´æ–°å‚æ•° - å¹³è¡¡æ›´æ–°é¢‘ç‡å’Œè®¡ç®—è´Ÿè½½
    do_beamskip: true            # å¯ç”¨å…‰æŸè·³è·ƒï¼Œæé«˜è®¡ç®—æ•ˆç‡
    global_frame_id: map
    update_min_d: 0.1          # é€‚å½“æé«˜æœ€å°å¹³ç§»æ›´æ–°é˜ˆå€¼ï¼Œå‡å°‘ä¸å¿…è¦æ›´æ–°
    update_min_a: 0.1            # é€‚å½“æé«˜æœ€å°è§’åº¦æ›´æ–°é˜ˆå€¼ï¼Œå‡å°‘æŠ–åŠ¨
    update_min_d_squared: 0.01   # æ·»åŠ å¹³æ–¹è·ç¦»é˜ˆå€¼ï¼Œæ›´ç²¾ç¡®æ§åˆ¶æ›´æ–°é¢‘ç‡
    
    # æ”¶æ•›åˆ¤æ–­å‚æ•° - è§£å†³å®šä½åæ— æ³•ç§»åŠ¨é—®é¢˜
    selective_resampling: true   # å¯ç”¨é€‰æ‹©æ€§é‡é‡‡æ ·ï¼Œé¿å…ç²’å­è´«åŒ–
    recovery_alpha_slow: 0.001   # æ…¢æ¢å¤æƒé‡ï¼ˆä¿æŒè¾ƒå°å€¼ï¼‰
    recovery_alpha_fast: 0.05    # é™ä½å¿«æ¢å¤æƒé‡ï¼Œé¿å…è¿‡åº¦å‘æ•£

    # è‡ªåŠ¨å…¨å±€åˆå§‹åŒ–
    save_pose_rate: 0.5
    resample_interval: 2  # ä½¿ç”¨è¾ƒå¤§çš„é‡é‡‡æ ·é—´éš”ï¼Œå‡å°‘è®¡ç®—è´Ÿæ‹…
    
    # è‡ªåŠ¨å…¨å±€å®šä½é…ç½®
    set_initial_pose: false          # ä¸è®¾ç½®åˆå§‹å§¿æ€ï¼Œè®©AMCLè‡ªåŠ¨å…¨å±€å®šä½
    always_reset_initial_pose: false  # ä¸æ€»æ˜¯é‡ç½®åˆå§‹å§¿æ€
    first_map_only: false           # ä¸åªåœ¨ç¬¬ä¸€ä¸ªåœ°å›¾æ—¶è¿è¡Œ
    
    # åˆå§‹å§¿æ€å‚æ•°ï¼ˆç”¨äºå…¨å±€å®šä½ï¼‰- ä¼˜åŒ–åœ°å›¾è¾¹ç•Œçº¦æŸ
    initial_pose:
      x: 0.0
      y: 0.0 
      theta: 0.0
    initial_covariance:
      x: 10.0      # Xæ–¹å‘å¤§æ–¹å·®ï¼Œå…è®¸åœ¨æ•´ä¸ªåœ°å›¾èŒƒå›´æœç´¢
      y: 10.0      # Yæ–¹å‘å¤§æ–¹å·®
      yaw: 3.14    # è§’åº¦å¤§æ–¹å·®ï¼Œå…è®¸ä»»æ„æœå‘
    # å…¨å±€å®šä½ç›¸å…³å‚æ•° - ä¼˜åŒ–å…¨å±€å®šä½æ€§èƒ½
    global_localization: true
    use_global_localization: true
    
    # å…³é”®å…¨å±€å®šä½ä¼˜åŒ–å‚æ•° - é˜²æ­¢å®šä½åˆ°åœ°å›¾å¤–
    force_update_on_initial_pose: true    # å¼ºåˆ¶åœ¨åˆå§‹ä½å§¿æ—¶æ›´æ–°
    use_clustering: true                  # å¯ç”¨èšç±»ï¼Œæé«˜å¤šå‡è®¾å¤„ç†èƒ½åŠ›
    cluster_dist: 1.5                     # å¢åŠ èšç±»è·ç¦»ï¼Œæ›´å¥½åœ°å¤„ç†å¤šå‡è®¾
    max_clusters: 2                       # å‡å°‘æœ€å¤§èšç±»æ•°ï¼Œè¿›ä¸€æ­¥é›†ä¸­ç²’å­åˆ†å¸ƒ
    
    # æ¿€å…‰é›·è¾¾ç›¸å…³å‚æ•°
    laser_likelihood_max_dist: 5.0  # æ¿€å…‰æœ€å¤§ä¼¼ç„¶è·ç¦»
    laser_model_type: "likelihood_field"  # æ¿€å…‰æ¨¡å‹ç±»å‹
    
    # åœ°å›¾è¾¹ç•Œå’Œçº¦æŸå‚æ•° - é˜²æ­¢å®šä½åˆ°åœ°å›¾å¤–
    map_check_ratio: 0.9                  # æé«˜åœ°å›¾è¾¹ç•Œæ£€æŸ¥æ¯”ä¾‹
    use_map_bounds: true                   # å¯ç”¨åœ°å›¾è¾¹ç•Œçº¦æŸ
    constrain_particles_in_map: true      # å¼ºåˆ¶ç²’å­åœ¨åœ°å›¾èŒƒå›´å†…
    map_padding: 0.8                       # å¢åŠ åœ°å›¾è¾¹ç•Œå†…è¾¹è·ï¼Œé¿å…ç²’å­é è¿‘è¾¹ç•Œ
    
    # å…¨å±€å®šä½æœç´¢ç­–ç•¥ - ä¸¥æ ¼é™åˆ¶æœç´¢èŒƒå›´
    global_localization_search_size: 2.0   # è¿›ä¸€æ­¥é™åˆ¶å…¨å±€æœç´¢èŒƒå›´ï¼ˆç±³ï¼‰
    restrict_global_search: true           # å¯ç”¨æœç´¢èŒƒå›´é™åˆ¶
    search_center_x: 0.0                  # æœç´¢ä¸­å¿ƒX
    search_center_y: 0.0                  # æœç´¢ä¸­å¿ƒY
    
    # è‡ªåŠ¨å…¨å±€å®šä½æœåŠ¡
    # å¯ç”¨å…¨å±€å®šä½æœåŠ¡ï¼Œå…è®¸é€šè¿‡æœåŠ¡è°ƒç”¨æ¥åˆå§‹åŒ–å…¨å±€å®šä½
    # å¯ä»¥é€šè¿‡å‘½ä»¤: ros2 service call /reinitialize_global_localization std_srvs/srv/Empty
    # æˆ–è€…ç­‰å¾…AMCLè‡ªåŠ¨è¿›è¡Œå…¨å±€å®šä½


bt_navigator:
  ros__parameters:
    use_sim_time: use_sim_time
    global_frame: map
    robot_base_frame: base_link
    odom_topic: /lio_sam/mapping/odometry
    bt_loop_duration: 10
    default_server_timeout: 20
    wait_for_service_timeout: 10
    # ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œè®©ç³»ç»Ÿè‡ªåŠ¨æŸ¥æ‰¾è¡Œä¸ºæ ‘æ–‡ä»¶
    default_nav_to_pose_bt_xml: "/opt/ros/humble/share/nav2_bt_navigator/behavior_trees/navigate_to_pose_w_replanning_and_recovery.xml"
    default_nav_through_poses_bt_xml: "/opt/ros/humble/share/nav2_bt_navigator/behavior_trees/navigate_through_poses_w_replanning_and_recovery.xml"
    plugin_lib_names: 
      - nav2_compute_path_to_pose_action_bt_node
      - nav2_compute_path_through_poses_action_bt_node
      - nav2_smooth_path_action_bt_node
      - nav2_follow_path_action_bt_node
      - nav2_spin_action_bt_node
      - nav2_wait_action_bt_node
      - nav2_assisted_teleop_action_bt_node
      - nav2_back_up_action_bt_node
      - nav2_drive_on_heading_bt_node
      - nav2_clear_costmap_service_bt_node
      - nav2_is_stuck_condition_bt_node
      - nav2_goal_reached_condition_bt_node
      - nav2_goal_updated_condition_bt_node
      - nav2_globally_updated_goal_condition_bt_node
      - nav2_is_path_valid_condition_bt_node
      - nav2_initial_pose_received_condition_bt_node
      - nav2_reinitialize_global_localization_service_bt_node
      - nav2_rate_controller_bt_node
      - nav2_distance_controller_bt_node
      - nav2_speed_controller_bt_node
      - nav2_truncate_path_action_bt_node
      - nav2_truncate_path_local_action_bt_node
      - nav2_goal_updater_node_bt_node
      - nav2_recovery_node_bt_node
      - nav2_pipeline_sequence_bt_node
      - nav2_round_robin_node_bt_node
      - nav2_transform_available_condition_bt_node
      - nav2_time_expired_condition_bt_node
      - nav2_path_expiring_timer_condition
      - nav2_distance_traveled_condition_bt_node
      - nav2_single_trigger_bt_node
      - nav2_goal_updated_controller_bt_node
      - nav2_is_battery_low_condition_bt_node
      - nav2_navigate_through_poses_action_bt_node
      - nav2_navigate_to_pose_action_bt_node
      - nav2_remove_passed_goals_action_bt_node
      - nav2_planner_selector_bt_node
      - nav2_controller_selector_bt_node
      - nav2_goal_checker_selector_bt_node
      - nav2_controller_cancel_bt_node
      - nav2_path_longer_on_approach_bt_node
      - nav2_wait_cancel_bt_node
      - nav2_spin_cancel_bt_node
      - nav2_back_up_cancel_bt_node
      - nav2_assisted_teleop_cancel_bt_node
      - nav2_drive_on_heading_cancel_bt_node
      - nav2_is_battery_charging_condition_bt_node

bt_navigator_navigate_through_poses_rclcpp_node:
  ros__parameters:
    use_sim_time: use_sim_time

bt_navigator_navigate_to_pose_rclcpp_node:
  ros__parameters:
    use_sim_time: use_sim_time


controller_server:
  ros__parameters:
    use_sim_time: use_sim_time
    controller_frequency: 20.0
    min_x_velocity_threshold: 0.001
    min_y_velocity_threshold: 0.5
    min_theta_velocity_threshold: 0.001
    failure_tolerance: 0.3
    progress_checker_plugin: "progress_checker"
    goal_checker_plugins: ["general_goal_checker"] 
    controller_plugins: ["FollowPath"]
    general_goal_checker:
      plugin: "nav2_controller::SimpleGoalChecker"
      xy_goal_tolerance: 0.25
      yaw_goal_tolerance: 0.25
      stateful: true
    FollowPath:
      plugin: "nav2_mppi_controller::MPPIController"
      time_steps: 45
      model_dt: 0.05
      batch_size: 1500
      vx_std: 0.2
      vy_std: 0.0
      wz_std: 0.4
      vx_max: 0.5
      vx_min: 0.0
      vy_max: 0.0
      wz_max: 0.5
      iteration_count: 1
      prune_distance: 1.7
      transform_tolerance: 0.1
      temperature: 0.3
      gamma: 0.015
      motion_model: "DiffDrive"
      visualize: false
      TrajectoryVisualizer:
        trajectory_step: 5
        time_step: 3
      AckermannConstraints:
        min_turning_r: 0.2
      critics: ["ConstraintCritic", "CostCritic", "GoalCritic", "GoalAngleCritic", "PathAlignCritic", "PathFollowCritic", "PathAngleCritic", "PreferForwardCritic", "ObstaclesCritic"]
      ConstraintCritic:
        enabled: true
        cost_power: 1
        cost_weight: 4.0
      GoalCritic:
        enabled: true
        cost_power: 1
        cost_weight: 5.0
        threshold_to_consider: 1.4
      GoalAngleCritic:
        enabled: true
        cost_power: 1
        cost_weight: 3.0
        threshold_to_consider: 0.5
      PreferForwardCritic:
        enabled: true
        cost_power: 1
        cost_weight: 5.0
        threshold_to_consider: 0.5
      ObstaclesCritic:
        enabled: true
        cost_power: 1
        repulsion_weight: 1.5
        critical_weight: 20.0
        consider_footprint: false
        collision_cost: 10000.0
        collision_margin_distance: 0.1
        near_goal_distance: 0.5
      CostCritic:
        enabled: true
        cost_power: 1
        cost_weight: 3.81
        critical_cost: 300.0
        consider_footprint: false
        collision_cost: 1000000.0
        near_goal_distance: 1.0
      PathAlignCritic:
        enabled: true
        cost_power: 1
        cost_weight: 14.0
        max_path_occupancy_ratio: 0.05
        trajectory_point_step: 3
        threshold_to_consider: 0.5
        offset_from_furthest: 20
        use_path_orientations: false
      PathFollowCritic:
        enabled: true
        cost_power: 1
        cost_weight: 5.0
        offset_from_furthest: 5
        threshold_to_consider: 1.4
      PathAngleCritic:
        enabled: true
        cost_power: 1
        cost_weight: 2.0
        offset_from_furthest: 4
        threshold_to_consider: 0.5
        max_angle_to_furthest: 1.0
        forward_preference: true
      # VelocityDeadbandCritic:
      #   enabled: true
      #   cost_power: 1
      #   cost_weight: 35.0
      #   deadband_velocities: [0.05, 0.05, 0.05]
      # TwirlingCritic:
      #   enabled: true
      #   twirling_cost_power: 1
      #   twirling_cost_weight: 10.0

local_costmap:
  local_costmap:
    ros__parameters:
      update_frequency: 5.0 # å±€éƒ¨åœ°å›¾æ›´æ–°é¢‘ç‡5hz
      publish_frequency: 2.0 # å‘å¸ƒé¢‘ç‡
      global_frame: odom # å±€éƒ¨åœ°å›¾åæ ‡ç³»
      robot_base_frame: base_link # æœºå™¨äººæœ¬ä½“åæ ‡ç³»
      use_sim_time: use_sim_time
      rolling_window: true # å±€éƒ¨åœ°å›¾é‚£ä¸ªçŸ©å½¢æ¡†æ˜¯å¦è·Ÿç€æœºå™¨äººå§¿æ€æ—‹è½¬
      width: 6 # å±€éƒ¨åœ°å›¾å¤§å°
      height: 6
      resolution: 0.05 # åˆ†è¾¨ç‡
      robot_radius: 0.3 # æœºå™¨äººåŠå¾„ï¼Œè°ƒæ•´ä¸ºåˆç†å€¼
      plugins: ["voxel_layer", "inflation_layer"]
      inflation_layer: # è†¨èƒ€å±‚
        plugin: "nav2_costmap_2d::InflationLayer" # è†¨èƒ€å±‚æ’ä»¶
        cost_scaling_factor: 3.0 # è†¨èƒ€å±‚æƒé‡åˆ†å¸ƒçš„å› å­
        inflation_radius: 0.5 # è†¨èƒ€åŠå¾„ï¼Œç•¥å¾®å‡å°
      voxel_layer: # ä½“ç´ å±‚ï¼Œå’Œéšœç¢ç‰©å±‚ç±»ä¼¼ï¼Œä¸»è¦æ˜¯ç”¨äºä¸‰ç»´éšœç¢ç‰©çš„æ£€æµ‹
        plugin: "nav2_costmap_2d::VoxelLayer"
        enabled: true
        publish_voxel_map: false # ç¦ç”¨å‘å¸ƒä»¥æé«˜æ€§èƒ½
        origin_z: -0.3 # zè½´çš„åŸç‚¹ï¼Œ0é»˜è®¤zè½´åŸç‚¹åœ¨æœºå™¨äººå¹³é¢ä¸Š
        z_resolution: 0.05 # zè½´æ–¹å‘ä½“ç´ åˆ†è¾¨ç‡
        z_voxels: 16 # zè½´ä¸Šä½“ç´ çš„ä¸ªæ•°
        max_obstacle_height: 1.5 # é™ä½æœ€å¤§éšœç¢ç‰©é«˜åº¦ä»¥å‡å°‘å™ªå£°
        mark_threshold: 1 # å¢åŠ æ ‡è®°é˜ˆå€¼ä»¥å‡å°‘è¯¯æŠ¥
        observation_sources: scan # ç®€åŒ–ä¸ºåªä½¿ç”¨æ¿€å…‰æ‰«ææ•°æ®
        scan: # æ¿€å…‰ä¼ æ„Ÿå™¨æ•°æ®çš„è¯¦ç»†é…ç½®
          topic: /lio_sam/scan
          max_obstacle_height: 1.5
          min_obstacle_height: -1.0
          clearing: true
          marking: true
          data_type: "LaserScan"
          raytrace_max_range: 8.0
          raytrace_min_range: 0.0
          obstacle_max_range: 2.5
          obstacle_min_range: 0.0
      always_send_full_costmap: false # ä¼˜åŒ–æ€§èƒ½
      # æ·»åŠ é¢å¤–çš„å®‰å…¨é…ç½®ä»¥é¿å…æœºå™¨äººè¶Šç•Œ
      track_unknown_space: true
      unknown_cost_value: 255
      lethal_cost_threshold: 100

global_costmap:
  global_costmap:
    ros__parameters:
      update_frequency: 1.0  # å…¨å±€åœ°å›¾æ›´æ–°çš„é¢‘ç‡
      publish_frequency: 1.0 # å‘å¸ƒé¢‘ç‡ï¼Œä¸€èˆ¬ç”¨äºrvizæ˜¾ç¤º
      global_frame: map      # å…¨å±€åœ°å›¾åæ ‡ç³»åç§°
      robot_base_frame: base_link # æœºå™¨äººæœ¬ä½“åæ ‡ç³»åç§°
      use_sim_time: use_sim_time # æ˜¯å¦ä½¿ç”¨ä»¿çœŸæ—¶é—´ï¼Œåœ¨çœŸæœºæ—¶è®¾ä¸ºfalse
      robot_radius: 0.3 # æœºå™¨äººåŠå¾„
      resolution: 0.05 # åœ°å›¾åˆ†è¾¨ç‡ï¼Œä¸€èˆ¬å’Œslamå»ºçš„å›¾ä¿æŒä¸€è‡´
      track_unknown_space: true
      # plugins: ["static_layer", "obstacle_layer", "inflation_layer"] # æ’ä»¶ï¼Œé‡‡ç”¨äº†å“ªäº›åœ°å›¾å±‚
      plugins: ["static_layer", "inflation_layer"] # æ’ä»¶ï¼Œé‡‡ç”¨äº†å“ªäº›åœ°å›¾å±‚
      # obstacle_layer:  # éšœç¢ç‰©å±‚
        # plugin: "nav2_costmap_2d::ObstacleLayer" # éšœç¢ç‰©å±‚æ’ä»¶
        # enabled: true
        # max_obstacle_intensity: 2.0
        # min_obstacle_intensity: 0.2
        # observation_sources: pointcloud
        # pointcloud:  # no frame set, uses frame from message
          # topic: /lio_sam/mapping/cloud_registered_raw  # produce error msg: can not compute xxxx, it is fine, just ignore it
          # topic: /lio_sam/deskew/cloud_deskewed
          # max_obstacle_height: 2.0
          # min_obstacle_height: 0.0
          # obstacle_max_range: 2.5
          # obstacle_min_range: 0.2
          # raytrace_max_range: 3.0
          # raytrace_min_range: 0.2
          # clearing: true
          # marking: true
          # data_type: "PointCloud2"
        # observation_sources: scan  # éšœç¢ç‰©å±‚æ•°æ®æ¥æºï¼Œä»å“ªäº›ä¼ æ„Ÿå™¨è·å¾—
        # scan: # æ¿€å…‰ä¼ æ„Ÿå™¨æ•°æ®çš„ä¸€äº›è¯¦ç»†é…ç½®
          # topic: /scan # ä¼ æ„Ÿå™¨è¯é¢˜
          # max_obstacle_height: 2.0 # éšœç¢ç‰©æœ€å¤§çš„è§‚æµ‹é«˜åº¦
          # clearing: true # éšœç¢ç‰©è§‚æµ‹æ•°æ®æ˜¯å¦ç”¨äºå°„çº¿æ¸…é™¤ï¼Œä¸€èˆ¬ä¸ºtrue(åŠ¨æ€éšœç¢ç‰©)
          # marking: true # æ˜¯å¦å°†è§‚æµ‹åˆ°çš„æ•°æ®æ ‡è®°ä¸ºéšœç¢ç‰©
          # data_type: "LaserScan" # æ•°æ®ç±»å‹ï¼Œnav2å®ç°çš„éšœç¢ç‰©å±‚åªèƒ½æ¥æ”¶LaserScanå’ŒPointCloud2ç±»å‹çš„æ•°æ®
          # raytrace_max_range: 3.0 # å°„çº¿æ¸…é™¤çš„æœ€å¤§è·ç¦»
          # raytrace_min_range: 0.0 # å°„çº¿æ¸…é™¤çš„æœ€å°è·ç¦»
          # obstacle_max_range: 2.5 # éšœç¢ç‰©æ ‡è®°çš„æœ€å¤§è·ç¦»
          # obstacle_min_range: 0.0 # éšœç¢ç‰©æ ‡è®°çš„æœ€å°è·ç¦»
      static_layer: # é™æ€åœ°å›¾å±‚
        plugin: "nav2_costmap_2d::StaticLayer" # é™æ€åœ°å›¾å±‚æ’ä»¶
        map_subscribe_transient_local: true
      inflation_layer: # è†¨èƒ€å±‚ï¼Œå®ƒçš„å®ç°æ˜¯ç›´æ¥æ“çºµåœ¨é™æ€åœ°å›¾å±‚ä¸Šçš„ï¼Œæ²¡æœ‰ç‹¬ç«‹åœ°å›¾å±‚
        plugin: "nav2_costmap_2d::InflationLayer" # è†¨èƒ€å±‚æ’ä»¶
        cost_scaling_factor: 3.0 # è†¨èƒ€å› å­ï¼Œæ§åˆ¶è†¨èƒ€å±‚æƒé‡è¡°å‡å› å­
        inflation_radius: 0.55 # è†¨èƒ€å±‚åŠå¾„
      always_send_full_costmap: true # æ˜¯å¦å‘é€æ•´å¼ åœ°å›¾

map_server:
  ros__parameters:
    use_sim_time: use_sim_time
    # ä½¿ç”¨é¡¹ç›®æ ¹ç›®å½•ä¸­çš„åœ°å›¾æ–‡ä»¶
    yaml_filename: /home/ywj/projects/map_grid/map.yaml
    # è®¾ç½®åœ°å›¾å‘å¸ƒé¢‘ç‡ä¸ºæ¯10ç§’ä¸€æ¬¡ï¼ˆ0.1Hzï¼‰
    publish_frequency: 1.0
    topic_name: "map"
    frame_id: "map"
    # å¦‚æœå­˜åœ¨ï¼Œç¡®ä¿å¯ç”¨å‘¨æœŸæ€§å‘å¸ƒ
    use_composition: true

map_saver:
  ros__parameters:
    use_sim_time: use_sim_time
    save_map_timeout: 5.0
    free_thresh_default: 0.49
    occupied_thresh_default: 0.55
    map_subscribe_transient_local: true

planner_server:
  ros__parameters:
    expected_planner_frequency: 20.0 # æœŸæœ›çš„è§„åˆ’å™¨é¢‘ç‡ï¼Œè·¯å¾„è®¡ç®—æœ‰è€—æ—¶ï¼Œæ‰€ä»¥æ˜¯æœŸæœ›è¾¾åˆ°çš„é¢‘ç‡
    use_sim_time: use_sim_time
    planner_plugins: ["GridBased"] # è¦åŠ è½½çš„è§„åˆ’å™¨idï¼Œåç»­åŠ¨ä½œè¯·æ±‚å…·ä½“ä½¿ç”¨å“ªä¸ªè§„åˆ’å™¨
    GridBased: # å¯¹åº”ä¸Šé¢è§„åˆ’å™¨idï¼Œä¸‹é¢ä¸ºæ­¤è§„åˆ’å™¨å†…çš„ä¸€äº›å‚æ•°è®¾ç½®
      plugin: "nav2_navfn_planner/NavfnPlanner" # æ­¤idè§„åˆ’å™¨å…·ä½“æŒ‡ä»£çš„è§„åˆ’å™¨æ’ä»¶
      tolerance: 0.5 # å…¬å·®
      use_astar: false
      allow_unknown: true

smoother_server:
  ros__parameters:
    use_sim_time: use_sim_time
    smoother_plugins: ["simple_smoother"]
    simple_smoother:
      plugin: "nav2_smoother::SimpleSmoother"
      tolerance: 1.0e-10
      max_its: 1000
      do_refinement: true

behavior_server:
  ros__parameters:
    costmap_topic: local_costmap/costmap_raw
    footprint_topic: local_costmap/published_footprint
    cycle_frequency: 10.0
    behavior_plugins: ["spin", "backup", "drive_on_heading", "assisted_teleop", "wait"]
    spin:
      plugin: "nav2_behaviors/Spin"
    backup:
      plugin: "nav2_behaviors/BackUp"
    drive_on_heading:
      plugin: "nav2_behaviors/DriveOnHeading"
    wait:
      plugin: "nav2_behaviors/Wait"
    assisted_teleop:
      plugin: "nav2_behaviors/AssistedTeleop"
    global_frame: map
    robot_base_frame: base_link
    transform_tolerance: 0.1
    use_sim_time: use_sim_time
    simulate_ahead_time: 2.0
    max_rotational_vel: 1.0
    min_rotational_vel: 0.4
    rotational_acc_lim: 3.2

robot_state_publisher:
  ros__parameters:
    use_sim_time: use_sim_time

waypoint_follower:
  ros__parameters:
    use_sim_time: use_sim_time
    loop_rate: 20
    stop_on_failure: false
    waypoint_task_executor_plugin: "wait_at_waypoint"
    wait_at_waypoint:
      plugin: "nav2_waypoint_follower::WaitAtWaypoint"
      enabled: true
      waypoint_pause_duration: 200

velocity_smoother:
  ros__parameters:
    use_sim_time: use_sim_time
    smoothing_frequency: 20.0
    scale_velocities: false
    feedback: "OPEN_LOOP"
    max_velocity: [0.26, 0.0, 1.0]
    min_velocity: [-0.26, 0.0, -1.0]
    max_accel: [2.5, 0.0, 3.2]
    max_decel: [-2.5, 0.0, -3.2]
    odom_topic: /lio_sam/mapping/odometry
    odom_duration: 0.1
    deadband_velocity: [0.0, 0.0, 0.0]
    velocity_timeout: 1.0

